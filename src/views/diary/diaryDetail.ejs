<!DOCTYPE html>
<html lang="ko">
  <link rel="stylesheet" href="../css/diaryDetail.css" />
  <head>
    <meta charset="UTF-8" />
    <title><%= diary.title %> - 다이어리</title>
  </head>

  <body>
    <h2><%= diary.title %></h2>
    <p><%= diary.description %></p>

    <hr />

    <!-- 멤버 목록 -->
    <h3>멤버</h3>
    <ul>
      <% diary.DiaryMembers.forEach(m => { %>
      <li><%= m.User.nick %> (<%= m.role %>)</li>
      <% }) %>
    </ul>

    <hr />

    <!-- 글쓰기 버튼 (멤버만 가능) -->
    <% if (isMember) { %>
    <a href="/post/create/<%= diary.id %>">+ 새 글쓰기</a>
    <% } else { %>
    <p>멤버가 아니라 글 작성이 불가능합니다.</p>
    <% } %>

    <hr />

    <!-- 게시글 목록 -->
    <h3>게시글</h3>

    <div class="posts-container">
      <% diary.Posts.forEach(post => { %>
      <div class="post-card <%= post.userId === user.id ? 'my-post' : '' %>">
        <div class="post-header">
          <span class="author"><%= post.User.nick %></span>
          <span class="date"><%= post.createdAt.toLocaleString() %></span>
        </div>

        <div class="post-content">
          <%= post.content.replace(/\n/g, "<br />") %>
        </div>
      </div>
      <% }) %>
    </div>

    <hr />
  </body>
</html>
